# data_processing 文件夹

该文件夹包含用于论文数据处理和微调数据集生成的完整代码流水线，专门用于再担保业务评审文档的处理、总结生成和质量评估。

## 文件说明

### 1. `file_process.py` - 文档解析与预处理
**功能：** 解析 Word 文档（.docx 格式）并将结构化内容提取为 JSONL 格式
- **主要功能：**
  - 解析再担保业务评审报告的标准结构
  - 提取六个主要分析部分：基本情况分析、经营管理分析、产品及市场分析、财务分析、企业担保用途分析、综合分析
  - 处理文档中的表格和文本内容
  - 将综合分析部分的子分类映射到对应的主分类中
- **输入：** Word 文档文件夹路径
- **输出：** `input_test.jsonl` 或 `input_train.jsonl`

### 2. `llm.py` - 大语言模型总结生成
**功能：** 使用 Qwen2.5-14B-Instruct 模型对提取的文档内容生成总结
- **主要功能：**
  - 基于预定义的提示模板生成文档总结
  - 使用 vLLM 进行高效推理
  - 支持批量处理 JSONL 格式数据
  - 配置可调的采样参数（temperature=0.3, top_p=0.8等）
- **输入：** 预处理后的 JSONL 文件、提示模板文件
- **输出：** 包含生成总结的 JSONL 文件（如 `output_train_Qwen2.5-14B-Instruct.jsonl`）

### 3. `prompt.txt` - 提示模板
**功能：** 存储用于指导大语言模型生成总结的提示模板
- **内容：** "你是一位资深的再担保业务评审员，请用一段话对以下文本进行总结"
- **用途：** 确保生成的总结符合业务专业要求

### 4. `assess.py` - 总结质量评估
**功能：** 使用 Qwen2.5-72B-Instruct 模型对生成的总结进行多维度质量评估
- **评估维度（共5个维度，每维度5分，总分25分）：**
  1. **真实性与准确性** - 总结内容是否准确完整
  2. **业务逻辑性** - 逻辑是否清晰，符合再担保业务逻辑
  3. **风险分析全面性** - 是否全面识别各类风险
  4. **重点突出与简洁性** - 是否突出核心信息且表达简洁
  5. **再担保决策支持价值** - 是否提供有价值的决策依据
- **输入：** 包含生成总结的 JSONL 文件
- **输出：** 包含详细评分和评分理由的 JSONL 文件

### 5. `scores.py` - 评分统计分析
**功能：** 统计和分析总结质量评估结果
- **主要功能：**
  - 提取各维度评分数据
  - 计算平均分、最高分、最低分
  - 按文档类别分组统计
  - 生成总体评分报告
- **输入：** 评估结果 JSONL 文件
- **输出：** 控制台输出的统计报告

### 6. `train.py` - 训练数据集生成
**功能：** 将处理后的数据转换为适合模型微调的格式
- **支持的训练任务类型：**
  - **总结生成任务** - instruction-input-output 格式
  - **总结优化任务** - 基于评分反馈的改进训练
  - **批判式训练** - 将结构化评分转换为自然语言批判
  - **DPO训练格式** - 对话式偏好优化数据
- **输入：** 评估结果文件和参考总结文件
- **输出：** 微调训练数据集（JSON格式）

## 数据处理流水线

```
Word文档 → file_process.py → JSONL预处理数据
    ↓
JSONL数据 + prompt.txt → llm.py → 生成总结的JSONL
    ↓
总结JSONL → assess.py → 评估结果JSONL
    ↓
评估结果 → scores.py → 统计报告
    ↓
评估结果 + 参考数据 → train.py → 训练数据集
```

## 使用方法

1. **文档预处理：** 运行 `file_process.py` 解析 Word 文档
2. **总结生成：** 运行 `llm.py` 生成总结
3. **质量评估：** 运行 `assess.py` 评估总结质量
4. **结果分析：** 运行 `scores.py` 查看统计结果
5. **数据集生成：** 运行 `train.py` 生成训练数据

## 依赖要求

- `transformers` - Hugging Face 变换器库
- `vllm` - 高效 LLM 推理引擎
- `python-docx` - Word 文档处理
- `jsonlines` - JSONL 文件处理
- `numpy` - 数值计算

## 注意事项

- 确保模型路径配置正确
- 根据硬件配置调整 GPU 内存使用率和并行度设置
- 文件路径需要根据实际情况修改

# LLaMA-Factory 文件夹

本项目采用 [LLaMA-Factory](https://github.com/hiyouga/LLaMA-Factory) 框架进行大语言模型微调。LLaMA-Factory 是一个高效、易用的大语言模型微调工具，支持 100+ 种模型的微调，提供零代码 CLI 和 Web UI 界面。

### 相关链接
- **官方文档：** https://llamafactory.readthedocs.io/
- **GitHub 仓库：** https://github.com/hiyouga/LLaMA-Factory
- **在线体验：** https://huggingface.co/spaces/hiyouga/LLaMA-Board